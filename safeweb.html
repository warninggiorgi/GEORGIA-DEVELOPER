<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Secure Mini Browser</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#111; color:#eee; }
header { padding:10px; background:#222; display:flex; }
input { flex:1; padding:8px; border-radius:4px; border:none; margin-right:8px; }
button { padding:8px 12px; border:none; border-radius:4px; background:#1f6feb; color:white; cursor:pointer; }
iframe { width:100%; height:calc(100vh - 50px); border:none; display:block; }
</style>
</head>
<body>

<header>
  <input id="url" type="text" placeholder="Enter URL..." value="https://mykadri.com">
  <button id="go">Go</button>
</header>

<iframe id="browser"></iframe>

<script>
const goBtn = document.getElementById('go');
const urlInput = document.getElementById('url');
const browser = document.getElementById('browser');

let blocklist = [];

// Load blocklist automatically
fetch('https://raw.githubusercontent.com/warninggiorgi/GEORGIA-DEVELOPER/refs/heads/main/georgi-adblock-saqartvelo.list')
.then(r => r.text())
.then(text => {
  blocklist = text.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('#'));
})
.catch(err => console.error('Failed to load blocklist', err));

async function fetchAndSanitize(url) {
  try {
    // Use public CORS proxy to bypass CORS restrictions
    const proxyURL = 'https://api.allorigins.win/get?url=' + encodeURIComponent(url);
    const res = await fetch(proxyURL);
    const data = await res.json();
    const html = data.contents;

    // Parse HTML
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    // Remove all <script> tags
    doc.querySelectorAll('script').forEach(s => s.remove());

    // Remove elements by blocklist (matches src/href)
    blocklist.forEach(pattern => {
      const elements = Array.from(doc.querySelectorAll('*')).filter(el => {
        const src = el.src || el.href || '';
        return src.includes(pattern.replace('*',''));
      });
      elements.forEach(el => el.remove());
    });

    // Serialize sanitized HTML and load in iframe
    const blob = new Blob([doc.documentElement.outerHTML], {type:'text/html'});
    const blobURL = URL.createObjectURL(blob);
    browser.src = blobURL;

  } catch(e) {
    alert('Failed to load page: ' + e.message);
  }
}

goBtn.onclick = () => {
  let url = urlInput.value.trim();
  if(!url.startsWith('http')) url = 'https://' + url;
  fetchAndSanitize(url);
};
</script>

</body>
</html>
