<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mini Browser with Blocklist</title>
<style>
body { font-family: Arial, sans-serif; background:#111; color:#eee; padding:20px; }
input, button { padding:8px; margin:5px 0; width: 100%; max-width: 600px; }
iframe { width: 100%; height: 600px; border:1px solid #444; margin-top:10px; }
textarea { width:100%; height:150px; margin-top:10px; background:#222; color:#eee; }
</style>
</head>
<body>

<h2>Mini Browser with Client-side Blocklist</h2>

<label>Target URL:</label>
<input id="url" type="text" placeholder="https://example.com" value="https://mykadri.com">

<label><input type="checkbox" id="stripScripts" checked> Remove <script> tags</label>

<button id="loadBtn">Load & Sanitize</button>

<h3>Blocklist Preview / Patterns:</h3>
<textarea id="blocklist" placeholder="Blocklist will load here..."></textarea>

<iframe id="browserFrame"></iframe>

<script>
const urlInput = document.getElementById('url');
const loadBtn = document.getElementById('loadBtn');
const stripScripts = document.getElementById('stripScripts');
const browserFrame = document.getElementById('browserFrame');
const blocklistArea = document.getElementById('blocklist');

let blocklist = [];

// Load blocklist from GitHub
fetch('https://raw.githubusercontent.com/warninggiorgi/GEORGIA-DEVELOPER/refs/heads/main/georgi-adblock-saqartvelo.list')
.then(r => r.text())
.then(text => {
    blocklist = text.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('#'));
    blocklistArea.value = blocklist.join('\n');
})
.catch(err => console.error('Failed to load blocklist', err));

function sanitizeHTML(html) {
    const parser = new DOMParser();
    const doc = parser.parseFromString(html, 'text/html');

    // Remove scripts if checked
    if(stripScripts.checked) {
        doc.querySelectorAll('script').forEach(s => s.remove());
    }

    // Remove elements by blocklist patterns
    blocklist.forEach(pattern => {
        const els = Array.from(doc.querySelectorAll('*')).filter(el => {
            const src = el.src || el.href || '';
            return src.includes(pattern.replace('*',''));
        });
        els.forEach(el => el.remove());
    });

    return doc.documentElement.outerHTML;
}

loadBtn.onclick = async () => {
    const targetURL = urlInput.value.trim();
    if(!targetURL) return alert('Enter a URL');
    try {
        let html = await fetch(targetURL).then(r => r.text());
        const sanitized = sanitizeHTML(html);
        const blob = new Blob([sanitized], {type:'text/html'});
        const blobURL = URL.createObjectURL(blob);
        browserFrame.src = blobURL;
    } catch(e) {
        alert('Failed to load URL: ' + e.message);
    }
};
</script>

</body>
</html>
